{
    "collab_server" : "",
    "contents" : "<<echo=FALSE>>=\n#### necessary libraries\nif (!require(\"pacman\")){\n    install.packages(\"pacman\")\n    library(pacman)\n}\npacman::p_load(dplyr, ggplot2, png, grid, forcats, archivist)\n\n#### working dir, git parameters & archivist\n# mywd <- \"/Users/michalfutrega/Downloads/project1-2\"\nmywd <- \"~/Dropbox/RiWizualizacja/project1\"\nsetwd(mywd)\nplotdir <- \"plots/\"\nGITusername <- \"LRajkowski\"\nGITpassword <- \"temppass100\"\nGITrepo <- \"pisa\"\n# createLocalRepo(GITrepo)\nsetLocalRepo(GITrepo)\nload(\"pisa.RData\")\nload(\"functions.RData\")\n\n#### report parameters    \nquestion_colname <- \"st29q04\"\nresults_colname <- \"pv1math\"\ncountry_colname <- \"cnt\"\nquestion_title <- \"I do math because I like it\"\nresults_title <- NULL\nshow_flag1 <- FALSE\nshow_flag2 <- TRUE\nflags_dir <- paste0(mywd, \"/flags/\")\nalpha <- 3\ncolor_boxes <- TRUE\nprint_weights <- TRUE\nlegend_position <- \"right\"\nlabels_order <- c(\"Strongly disagree\", \"Disagree\", \"Agree\", \"Strongly agree\")\nsub_fontsize <- 5\narepo_fontsize <- 5\n@\n\n<<results=tex, echo=FALSE>>=\nTeXpackages() \nTeXtheme() \nTeXbasicdata() \nTeXbutton() \nTeXtitlepage() \nTeXTOC()\n@\n\n\\SweaveOpts{concordance=TRUE}\n<<results=tex,echo=FALSE>>=\n#### pulling the GitHub repo\npulltext <- paste0(\"cd \", GITrepo, \"; git pull origin\")\nsystem(pulltext)\n\n#### data preparation\ndata <- pisa\ncountries <- sort(as.character(unique(pisa[,country_colname])) ) # weÅº wszystkie kraje i posortuj\ndata <- changeColnames(data,\n                 oldNames = c(country_colname, results_colname, question_colname),\n                 newNames = c(\"cnt\", \"results\", \"question\"))\ndata$question <- ordered(data$question, labels_order)\n\ndataCollapsed <- data %>% \n    mutate(question = fct_collapse(question, \n                           \"(Strongly) Agree\"=c(\"Agree\", \"Strongly agree\"),\n                         \"(Strongly) Disagree\"=c(\"Disagree\", \"Strongly disagree\")))\n\n#### initial calculation, computing the ranking list\nmeansPerCountry <- data %>% \n    group_by(cnt) %>% \n    summarize(m = mean(results))\nmeansPerCountry$place <- rank(-meansPerCountry$m) \nmax_rank <- max(meansPerCountry$place)\n\nfor(country in countries){\n    #### computations for given country ####\n    \n    ## the first plot\n    thisCountryBoxplot <- compareBoxplot(\n            data, country, \"cnt\", \"results\", \"question\",\n            question_title, results_title, show_flag1, flags_dir, alpha, color_boxes, print_weights\n    )\n    thisCountryBoxplotMD5 <- asave(thisCountryBoxplot)\n    file1=paste(plotdir, \"temp1_\", gsub(\" \", \"\", country), \".eps\", sep=\"\")\n    ggsaveInLatexLoop( thisCountryBoxplot,  file1, 7, 4)\n    \n    ## the second plot\n    thisCountryDensity <- compareDensity(\n            dataCollapsed, country, \"cnt\", \"results\", \"question\",\n            question_title, results_title, show_flag2, flags_dir, alpha, legend_position\n    )\n    thisCountryDensityMD5 <- asave(thisCountryDensity)\n    file2=paste(plotdir, \"temp2_\", gsub(\" \", \"\", country), \".eps\", sep=\"\")\n    ggsaveInLatexLoop( thisCountryDensity,  file2, 6, 4)\n    \n    ## the third plot\n    thisCountryRankPlot <- compareRank(country, meansPerCountry) \n    thisCountryRankPlotMD5 <- asave(thisCountryRankPlot)\n    file3=paste(plotdir, \"temp3_\", gsub(\" \", \"\", country), \".eps\", sep=\"\")\n    ggsaveInLatexLoop( thisCountryRankPlot, file3, 7, 4)\n\n    ## computations of ranking\n    thisCountryRank <- meansPerCountry %>% filter(cnt==country) %>% select(place) %>% as.numeric\n    \n    ### TeXing ####\n    TeXcountrySummary(\n        country, file1, file2, file3,\n        GITusername, GITrepo, \n        thisCountryBoxplotMD5, thisCountryDensityMD5, thisCountryRankPlotMD5,\n        arepo_fontsize\n    )\n}\n\nGITpushAndCommit(GITrepo, GITusername)\n@\n\n\\end{document}",
    "created" : 1509903109295.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3439060558",
    "id" : "A521476D",
    "lastKnownWriteTime" : 1509913720,
    "last_content_update" : 1509913720779,
    "path" : "~/Dropbox/RiWizualizacja/project1/report.Rnw",
    "project_path" : "report.Rnw",
    "properties" : {
        "marks" : "<:15,16\n>:15,16"
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "sweave"
}